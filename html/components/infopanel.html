
<div class="row">
    <div class="col">
        <br>
    </div>
</div>
<div class="row border border-primary rounded">
    <div class="col">
        <p>Item: {{ parent_names | join(sep=' / ') }}</p>
    </div>
    {% for i in agent_items %}
    <div class="col">
        <p>
            <button class="btn btn-link p-0 text-start text-primary"
                    hx-get="/components/agent-modal.html?agent_name={{ i.agent.name | urlencode }}&item_path={{ item_path | join(sep='%2F') | urlencode }}"
                    hx-target="#agentModalBody"
                    data-bs-toggle="modal"
                    data-bs-target="#agentModal"
                    style="border: none; background: none; font-weight: inherit;">
                {{ i.agent.name }}
            </button>
        </p>
        {% if i.sync_status == "In Sync" %}
        <p>Status: {{ i.sync_status }}</p>
        {% else %}
        <p style="color: red;">Status: {{ i.sync_status }}</p>
        {% endif %}
        {% if i.sync_status != "Missing" %}
        <p>Size: {{ (i.item.size_kb / 1024) | round(precision=2) }} mb</p>
        {% endif %}
        <div class="d-flex justify-content-start mt-2">
            {% if i.ignored %}
            <button class="btn btn-success btn-sm px-3" disabled>
                Ignored
            </button>
            {% else %}
            <button class="btn btn-warning btn-sm px-3"
                    id="ignore-btn-{{ i.agent.name | replace(from=' ', to='-') | lower }}"
                    hx-post="/components/ignore"
                    hx-ext="json-enc"
                    hx-include="#ignore-btn-{{ i.agent.name | replace(from=' ', to='-') | lower }} input"
                    hx-confirm="Are you sure you want to ignore this item on {{ i.agent.name }}?"
                    hx-swap="none"
                    hx-on::after-request="
                        if(event.detail.xhr.status === 200) {
                            try {
                                const response = JSON.parse(event.detail.xhr.responseText);
                                if(response.success) {
                                    this.textContent = 'Ignored';
                                    this.disabled = true;
                                    this.classList.remove('btn-warning');
                                    this.classList.add('btn-success');
                                    showToast('Item ignored successfully', 'success');
                                    // Refresh item data
                                    refreshItemData();
                                } else {
                                    showToast(response.message, 'error');
                                }
                            } catch (parseError) {
                                showToast('Failed to parse server response', 'error');
                            }
                        } else {
                            showToast('Request failed with status: ' + event.detail.xhr.status, 'error');
                        }">
                Ignore
                <input type="hidden" name="agent_name" value="{{ i.agent.name }}">
                {% for path_item in item_path %}
                <input type="hidden" name="item_path" value="{{ path_item }}">
                {% endfor %}
                {% for hierarchy_item in hierarchy_names %}
                <input type="hidden" name="hierarchy_names" value="{{ hierarchy_item }}">
                {% endfor %}
            </button>
            {% endif %}
            {% if i.sync_status != "Missing" %}
            <button class="btn btn-danger btn-sm px-3 ms-2"
                    id="delete-btn-{{ i.agent.name | replace(from=' ', to='-') | lower }}"
                    data-bs-toggle="modal"
                    data-bs-target="#deleteModal"
                    data-agent-name="{{ i.agent.name }}"
                    data-item-path="{{ item_path | join(sep=',') }}"
                    data-hierarchy-names="{{ hierarchy_names | join(sep=',') }}"
                    data-item-name="{{ parent_names | join(sep=' / ') }}"
                    onclick="setupDeleteModal(this)">
                Delete
            </button>
            {% endif %}
        </div>
    </div>
    {% endfor %}
    {% if agent_items | length == 0 %}
    {% endif %}
</div>

